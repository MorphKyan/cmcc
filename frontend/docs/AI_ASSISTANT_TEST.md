# AI Assistant Widget 测试指南

## 测试环境准备

### 1. 启动后端服务

```bash
cd c:\Users\MorphKyan\cmcc
python main.py
```

### 2. 启动前端开发服务器

```bash
cd c:\Users\MorphKyan\cmcc\frontend
npm install
npm run dev
```

---

## 功能测试用例

### TC-01: 组件加载测试

| 项目 | 内容 |
|------|------|
| **前置条件** | 前端开发服务器运行中 |
| **测试步骤** | 访问 `https://localhost:5173/ai-assistant-demo.html` |
| **预期结果** | 页面右下角显示紫色渐变的AI助手浮动按钮 |

---

### TC-02: 拖拽功能测试

| 项目 | 内容 |
|------|------|
| **测试步骤** | 1. 按住AI助手图标<br>2. 拖动到页面左上角<br>3. 释放鼠标 |
| **预期结果** | 图标跟随鼠标移动，释放后保持在新位置 |

---

### TC-03: 边界检测测试

| 项目 | 内容 |
|------|------|
| **测试步骤** | 尝试将图标拖出页面边界 |
| **预期结果** | 图标自动停止在页面边缘，不会超出可视区域 |

---

### TC-04: 录音启动测试

| 项目 | 内容 |
|------|------|
| **前置条件** | 后端服务运行中 |
| **测试步骤** | 点击AI助手图标 |
| **预期结果** | 1. 浏览器弹出麦克风权限请求<br>2. 授权后图标变为红色渐变<br>3. 出现脉冲动画效果<br>4. 显示结果反馈面板 |

---

### TC-05: 录音停止测试

| 项目 | 内容 |
|------|------|
| **前置条件** | 正在录音状态 |
| **测试步骤** | 再次点击AI助手图标 |
| **预期结果** | 1. 录音停止<br>2. 图标恢复紫色渐变<br>3. 脉冲动画消失 |

---

### TC-06: 用户ID持久化测试

| 项目 | 内容 |
|------|------|
| **测试步骤** | 1. 打开浏览器控制台<br>2. 执行 `localStorage.getItem('ai-assistant-user-id')`<br>3. 记录ID值<br>4. 刷新页面<br>5. 再次执行相同命令 |
| **预期结果** | 两次获取的用户ID相同 |

---

### TC-07: WebSocket连接测试

| 项目 | 内容 |
|------|------|
| **前置条件** | 后端服务运行中 |
| **测试步骤** | 1. 开始录音<br>2. 打开浏览器开发者工具 Network 面板<br>3. 筛选 WS 类型 |
| **预期结果** | 显示活跃的WebSocket连接，状态为101 |

---

### TC-08: LLM结果反馈测试

| 项目 | 内容 |
|------|------|
| **前置条件** | 后端LLM服务正常 |
| **测试步骤** | 1. 开始录音<br>2. 说话一段时间<br>3. 停止录音 |
| **预期结果** | 结果面板显示LLM处理后的响应文本 |

---

### TC-09: 自动重连测试

| 项目 | 内容 |
|------|------|
| **测试步骤** | 1. 开始录音<br>2. 停止后端服务<br>3. 等待几秒 |
| **预期结果** | 显示"重新连接中..."提示，尝试次数递增 |

---

### TC-10: 主题切换测试

| 项目 | 内容 |
|------|------|
| **测试步骤** | 初始化时设置 `theme: 'light'` |
| **预期结果** | 结果面板使用浅色主题样式 |

---

## 跨浏览器测试

| 浏览器 | 版本 | 状态 |
|--------|------|------|
| Chrome | 120+ | ⬜ 待测 |
| Firefox | 120+ | ⬜ 待测 |
| Safari | 17+ | ⬜ 待测 |
| Edge | 120+ | ⬜ 待测 |

---

## 移动端测试

| 设备 | 操作系统 | 状态 |
|------|----------|------|
| iPhone 15 | iOS 17 | ⬜ 待测 |
| Samsung Galaxy | Android 14 | ⬜ 待测 |

### 移动端特殊测试点
- 触摸拖拽功能
- 虚拟键盘弹出时布局
- 麦克风权限弹窗

---

## 性能测试

### 内存泄漏检测

```javascript
// 在控制台执行多次初始化/销毁循环
for (let i = 0; i < 10; i++) {
  AIAssistant.init({ backendUrl: 'https://local.morph.icu:5000' });
  await new Promise(r => setTimeout(r, 1000));
  AIAssistant.destroy();
}
// 检查 Memory 面板是否有内存增长
```

### 长时间录音测试

| 项目 | 内容 |
|------|------|
| **测试步骤** | 连续录音5分钟以上 |
| **预期结果** | 内存占用稳定，无明显增长 |

---

## 测试检查清单

- [ ] TC-01: 组件加载
- [ ] TC-02: 拖拽功能
- [ ] TC-03: 边界检测
- [ ] TC-04: 录音启动
- [ ] TC-05: 录音停止
- [ ] TC-06: 用户ID持久化
- [ ] TC-07: WebSocket连接
- [ ] TC-08: LLM结果反馈
- [ ] TC-09: 自动重连
- [ ] TC-10: 主题切换
